name: Branch Protection

on:
  pull_request:
    branches: [master, main]
  push:
    branches: [master, main]

jobs:
  protect-master:
    if: (github.event_name == 'push' && (github.ref == 'refs/heads/master' || github.ref == 'refs/heads/main'))
    runs-on: ubuntu-latest
    steps:
      - name: Check if direct push to master/main
        run: |
          echo "âŒ Direct pushes to master/main are not allowed!"
          echo "ğŸ“ Please create a pull request to develop branch first"
          echo "ğŸ”„ Then merge develop to master/main through a pull request"
          exit 1

  enforce-pr-flow:
    if: github.event_name == 'pull_request' && (github.base.ref == 'master' || github.base.ref == 'main')
    runs-on: ubuntu-latest
    steps:
      - name: Check PR source branch
        run: |
          if [[ "${{ github.head.ref }}" != "develop" ]]; then
            echo "âŒ PRs to master/main must come from develop branch!"
            echo "ğŸ“ Please create PR to develop first, then merge develop to master/main"
            exit 1
          fi
          echo "âœ… PR from develop to master/main is allowed"
